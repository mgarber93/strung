!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.strung=e():t.strung=e()}(global,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var r=["!","#","$","%","&","(",")","*","+",",","-","/","0","1","2","3","4","6","7","8","9",":",";","<","=",">","?","@","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","[","]","^","_","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];const i=".",o=r.length,s=Math.floor(Math.log2(o));function c(){let t=function(t){let e=-1;const n=r;for(;t.charAt(t.length-1-++e)===i;);let o=n.indexOf(t.charAt(t.length-e-1)).toString(2).padStart(s,"0").slice(e-s);for(let r=t.length-e-2;r>=0;r--)o=n.indexOf(t.charAt(r)).toString(2).padStart(s,"0")+o;return o}.toString();const e=`'${r.join("")}'`;return t=t.replace(new RegExp("encodableSymbols","g"),e).replace(new RegExp("endOfFileSymbol","g"),`'${i}'`).replace(new RegExp("bitsPerCharacter","g"),String(s))}class l{constructor(t,e){this.char=t,this.freq=e,this.left=null,this.right=null}buildPath(t){return this.left&&t.test(this.left.char)?"0"+this.left.buildPath(t):this.right&&t.test(this.right.char)?"1"+this.right.buildPath(t):(console.assert(1===this.char.length,["Didn't find node!",this.left&&`left is: ${this.left.char}`,this.right&&`right is: ${this.right.char}`,`looking for: ${t}`].join(", ")),"")}static combine(t,e){const n=new l(t.char+e.char,t.freq+e.freq);return n.left=t,n.right=e,n}toString(){let t="";return this.left&&(t+=this.left.toString()),1===this.char.length&&(t+=this.char),this.right&&(t+=this.right.toString()),t}}var h=class{constructor(t,e={}){Object.assign.call(this,{log:console.log,decoderSigniture:"$$$$"},e),this.mapCharToFreq=t.split("").reduce((t,e)=>(t[e]=(t[e]||0)+1,t),{});const n=Object.entries(this.mapCharToFreq).map(([t,e])=>new l(t,e));this.root=this.build(n)}static decoderCallLength(){return 4}getMostCommonChar(){return Object.entries(this.mapCharToFreq).reduce(([t,e],[n,r])=>!t||r>e?[n,r]:[t,e])}getMostRareChar(){return Object.entries(this.mapCharToFreq).reduce(([t,e],[n,r])=>!t||r<e?[n,r]:[t,e])}build(t){if(t.length<=1)return t[0];t.sort(function(t,e){return t.freq<e.freq?1:e.freq<t.freq?-1:0});const e=t.pop(),n=t.pop();return t.push(l.combine(e,n)),this.build(t)}parsingWorked(t,e){return!e||Math.abs(t-e)>Number.EPSILON}decompressString(t){return t.slice(1,-1).split(",").map(t=>parseInt(t,36).toString(2)).join("")}calculateStringReport(t){return`${new Set(t.split("")).size} symbols`}encode(t,e=!1){let n="",o=-1;for(;++o<t.length;){const e=new RegExp(this.escape(t[o]));n+=this.root.buildPath(e)}const c=`$$$$("${e?n:function(t){let e=t,n="";for(;e.length>=s;){let t=e.slice(0,s);const i=parseInt(t,2);n+=r[i],e=e.slice(s)}return e.length&&(n+=r[parseInt(e,2)]+Array(s-e.length).fill(i).join("")),n}(n)}")`;if(this.verbose){const e=this.calculateStringReport(t);this.log(`changed by ${c.length-t.length} characters (${(100*(c.length-t.length)/t.length).toString().substring(0,6)}%) ${e}`)}return c}escape(t){return[".","(",")","[","]","?","+",",","*","\\"].includes(t)?`\\${t}`:t}serializeTree(){const t=this.root.char,e={};for(let n=0;n<t.length;n++){const r=new RegExp(this.escape(t[n])),i=this.root.buildPath(r);console.assert(!e.hasOwnProperty(i),`path colision at: ${i} between ${e[i]} and ${t[n]}.`),e[i]=t[n]}return e}makeDecoder(){const t=`function ${this.decoderSigniture}(c) {\n  ${c()}\n  let str = bdcmp(c)\n  let i = -1\n  let o = ''\n  const t = ${JSON.stringify(this.serializeTree())}\n  while(++i <= str.length) {\n    if (t.hasOwnProperty(str.slice(0, i === 0 ? 1 : i))) {\n      o += t[str.slice(0, i === 0 ? 1 : i)]\n      str = str.slice(i)\n      i = -1\n    }\n  }\n  return o\n}\n`;return this.verbose&&this.log(`decoder size: ${t.length}`),t}};class u{constructor(t=!1){this.content="",this.end=-1,this.isString=!!t}length(){return this.content.length}}var a=function(t){let e=!1,n=-1,r=new u;const i=[];for(;++n<t.length;)if(e)e=!1,r.content+="${file[index]}";else if("\\"===t[n])e=!0;else if('"'===t[n]||"'"===t[n]){const e=r.isString;e&&(r.content+=t[n]),r.end=n,i.push(r),r=new u(!r.isString),e||(r.content+=t[n])}else r.content+=t[n];return i.push(r),i};function g(t){return t.isString&&t.length()>h.decoderCallLength()}e.default=class{constructor(t={}){this.segments=[],Object.assign(this,t)}strungify(t){const e=a(t),n=new h(e.filter(g).map(t=>t.content.slice(1,-1)).join(""),this);return e.filter(g).forEach(t=>{t.content=n.encode(t.content.slice(1,-1))}),n.makeDecoder()+e.map(t=>t.content).join("")}apply(t){t.hooks.compilation.tap("Strung",t=>{t.hooks.succeedModule.tap("Strung",t=>{const e=t._source.source(),n=this.strungify(e);t._source._value=n})}),t.hooks.emit.tap("Strung",function(t){let e="In this build:\n\n";for(let n in t.assets)e+="- "+n+"\n";t.assets["strung-results.md"]={source:function(){return e},size:function(){return e.length}}})}}}])});